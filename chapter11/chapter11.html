<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Let there be even more light | 使用 LWJGL 3 开发 3D 游戏</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/3d-game-development-with-lwjgl/assets/css/0.styles.33e5fdc6.css" as="style"><link rel="preload" href="/3d-game-development-with-lwjgl/assets/js/app.519c1cc5.js" as="script"><link rel="preload" href="/3d-game-development-with-lwjgl/assets/js/2.e7870360.js" as="script"><link rel="preload" href="/3d-game-development-with-lwjgl/assets/js/20.9046ed34.js" as="script"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/10.7296f99c.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/11.a42afaf0.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/12.b7fdae6a.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/13.01b80f30.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/14.06f37286.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/15.c4635c97.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/16.f4253e97.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/17.c7f6896c.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/18.8a24c215.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/19.ab6ce5f4.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/21.3cb4242e.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/22.b2fa78a0.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/23.a9e504af.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/24.12580511.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/25.a115cf89.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/26.7193040d.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/27.4fa5cc0d.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/28.e559af67.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/29.d5befc6c.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/3.8fb1d8aa.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/30.ee00c5df.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/31.0effa8ac.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/32.c13100cf.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/33.c9fbfcdb.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/34.7bde7785.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/35.604c8847.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/36.ccd3a84c.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/37.ec274013.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/38.66d82b73.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/4.e1b9ee22.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/5.75c3f2db.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/6.601d5460.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/7.1f9c2020.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/8.be9c92d8.js"><link rel="prefetch" href="/3d-game-development-with-lwjgl/assets/js/9.048bb756.js">
    <link rel="stylesheet" href="/3d-game-development-with-lwjgl/assets/css/0.styles.33e5fdc6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/3d-game-development-with-lwjgl/" class="home-link router-link-active"><!----> <span class="site-name">使用 LWJGL 3 开发 3D 游戏</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/3d-game-development-with-lwjgl/" aria-current="page" class="sidebar-link">封面</a></li><li><a href="/3d-game-development-with-lwjgl/INTRODUCTION.html" class="sidebar-link">简介</a></li><li><a href="/3d-game-development-with-lwjgl/chapter01/chapter1.html" class="sidebar-link">第一步</a></li><li><a href="/3d-game-development-with-lwjgl/chapter02/chapter2.html" class="sidebar-link">The Game Loop</a></li><li><a href="/3d-game-development-with-lwjgl/chapter03/chapter3.html" class="sidebar-link">A brief about coordinates</a></li><li><a href="/3d-game-development-with-lwjgl/chapter04/chapter4.html" class="sidebar-link">Rendering</a></li><li><a href="/3d-game-development-with-lwjgl/chapter05/chapter5.html" class="sidebar-link">More on Rendering</a></li><li><a href="/3d-game-development-with-lwjgl/chapter06/chapter6.html" class="sidebar-link">Transformations</a></li><li><a href="/3d-game-development-with-lwjgl/chapter07/chapter7.html" class="sidebar-link">Textures</a></li><li><a href="/3d-game-development-with-lwjgl/chapter08/chapter8.html" class="sidebar-link">Camera</a></li><li><a href="/3d-game-development-with-lwjgl/chapter09/chapter9.html" class="sidebar-link">Loading more complex models</a></li><li><a href="/3d-game-development-with-lwjgl/chapter10/chapter10.html" class="sidebar-link">Let there be light</a></li><li><a href="/3d-game-development-with-lwjgl/chapter11/chapter11.html" aria-current="page" class="active sidebar-link">Let there be even more light</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/3d-game-development-with-lwjgl/chapter11/chapter11.html#directional-light" class="sidebar-link">Directional Light</a></li><li class="sidebar-sub-header"><a href="/3d-game-development-with-lwjgl/chapter11/chapter11.html#spot-light" class="sidebar-link">Spot Light</a></li><li class="sidebar-sub-header"><a href="/3d-game-development-with-lwjgl/chapter11/chapter11.html#multiple-lights" class="sidebar-link">Multiple Lights</a></li></ul></li><li><a href="/3d-game-development-with-lwjgl/chapter12/chapter12.html" class="sidebar-link">Game HUD</a></li><li><a href="/3d-game-development-with-lwjgl/chapter13/chapter13.html" class="sidebar-link">Sky Box and some optimizations</a></li><li><a href="/3d-game-development-with-lwjgl/chapter14/chapter14.html" class="sidebar-link">Height Maps</a></li><li><a href="/3d-game-development-with-lwjgl/chapter15/chapter15.html" class="sidebar-link">Terrain Collisions</a></li><li><a href="/3d-game-development-with-lwjgl/chapter16/chapter16.html" class="sidebar-link">Fog</a></li><li><a href="/3d-game-development-with-lwjgl/chapter17/chapter17.html" class="sidebar-link">Normal Mapping</a></li><li><a href="/3d-game-development-with-lwjgl/chapter18/chapter18.html" class="sidebar-link">Shadows</a></li><li><a href="/3d-game-development-with-lwjgl/chapter19/chapter19.html" class="sidebar-link">Animations</a></li><li><a href="/3d-game-development-with-lwjgl/chapter20/chapter20.html" class="sidebar-link">Particles</a></li><li><a href="/3d-game-development-with-lwjgl/chapter21/chapter21.html" class="sidebar-link">Instanced Rendering</a></li><li><a href="/3d-game-development-with-lwjgl/chapter22/chapter22.html" class="sidebar-link">Audio</a></li><li><a href="/3d-game-development-with-lwjgl/chapter23/chapter23.html" class="sidebar-link">3D Object Picking</a></li><li><a href="/3d-game-development-with-lwjgl/chapter24/chapter24.html" class="sidebar-link">HUD Revisited - NanoVG</a></li><li><a href="/3d-game-development-with-lwjgl/chapter25/chapter25.html" class="sidebar-link">Optimizations - Frustum Culling \(I\)</a></li><li><a href="/3d-game-development-with-lwjgl/chapter26/chapter26.html" class="sidebar-link">Cascaded Shadow Maps</a></li><li><a href="/3d-game-development-with-lwjgl/chapter27/chapter27.html" class="sidebar-link">Assimp</a></li><li><a href="/3d-game-development-with-lwjgl/chapter28/chapter28.html" class="sidebar-link">Deferred Shading</a></li><li><a href="/3d-game-development-with-lwjgl/appendixa/appendixa.html" class="sidebar-link">Appendix A - OpenGL Debugging</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="let-there-be-even-more-light"><a href="#let-there-be-even-more-light" class="header-anchor">#</a> Let there be even more light</h1> <p>In this chapter we are going to implement other light types that we introduced in previous chapter. We will start with directional lighting.</p> <h2 id="directional-light"><a href="#directional-light" class="header-anchor">#</a> Directional Light</h2> <p>If you recall, directional lighting hits all the objects by parallel rays all coming from the same direction. It models light sources that are far away but have a high intensity such as the Sun.</p> <p><img src="directional_light.png" alt="Directional Light"></p> <p>Another characteristic of directional light is that it is not affected by attenuation. Think again about sunlight: all objects that are hit by rays of light are illuminated with the same intensity, as the distance from the sun is so huge that the position of the objects is irrelevant. In fact, directional lights are modeled as light sources placed at infinity, if it was affected by attenuation it would have no effect in any object (its colour contribution would be equal to $$0$$).</p> <p>Besides that, directional light is composed also by a diffuse and specular components. The only differences with point lights is that it does not have a position but a direction and that it is not affected by attenuation. Let’s get back to the direction attribute of directional light, and imagine we are modeling the movement of the sun across our 3D world. If we are assuming that the north is placed towards the increasing z-axis, the following picture shows the direction to the light source at dawn, mid day and dusk.</p> <p><img src="sun_directional_light.png" alt="Sun as a directional light"></p> <p>Light directions for the above positions are:</p> <ul><li>Dawn: (-1, 0, 0)</li> <li>Mid day: (0, 1, 0)</li> <li>Dusk: (1, 0, 0)</li></ul> <p>Side note: You may think that above coordinates are equal to position ones, but they model a vector, a direction, not a position. From the mathematical point of view a vector and a position are indistinguishable, but they have a totally different meaning.</p> <p>But how do we model the fact that this light is located at infinity? The answer is by using the $$w$$ component, that is, by using homogeneous coordinates and setting the $$w$$ component to $$0$$:</p> <ul><li>Dawn: (-1, 0, 0, 0)</li> <li>Mid day: (0, 1, 0, 0)</li> <li>Dusk: (1, 0, 0, 0)</li></ul> <p>This is the same case as when we pass the normals, for normals we set the $$w$$ component to $$0$$ to state that we are not interested in displacements, just in the direction. Also, when we deal with directional light we need to do the same, camera translations should not affect the direction of a directional light.</p> <p>So let’s start coding and model our directional light. The first thing we are going to do is to create a class that models its attributes. It will be another POJO with a copy constructor which stores the direction, the colour and the intensity of the light.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>lwjglb<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>graph</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>joml<span class="token punctuation">.</span></span><span class="token class-name">Vector3f</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DirectionalLight</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Vector3f</span> color<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Vector3f</span> direction<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">float</span> intensity<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DirectionalLight</span><span class="token punctuation">(</span><span class="token class-name">Vector3f</span> color<span class="token punctuation">,</span> <span class="token class-name">Vector3f</span> direction<span class="token punctuation">,</span> <span class="token keyword">float</span> intensity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">=</span> direction<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>intensity <span class="token operator">=</span> intensity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">DirectionalLight</span><span class="token punctuation">(</span><span class="token class-name">DirectionalLight</span> light<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Vector3f</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Vector3f</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span><span class="token function">getDirection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> light<span class="token punctuation">.</span><span class="token function">getIntensity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Getters and setters beyond this point...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>As you can see, we are still using a <code>Vector3f</code> to model the direction. Keep calm, we will deal with the $$w$$ component when we transfer the directional light to the shader. And by the way, the next thing that we do is to update the <code>ShaderProgram</code> to create and update the uniform that will hold the directional light.</p> <p>In our fragment shader we will define a structure that models a directional light.</p> <div class="language-glsl line-numbers-mode"><pre class="language-glsl"><code><span class="token keyword">struct</span> <span class="token class-name">DirectionalLight</span>
<span class="token punctuation">{</span>
    <span class="token keyword">vec3</span> colour<span class="token punctuation">;</span>
    <span class="token keyword">vec3</span> direction<span class="token punctuation">;</span>
    <span class="token keyword">float</span> intensity<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>With that definition, the new methods in the <code>ShaderProgram</code> class are straightforward.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createDirectionalLightUniform</span><span class="token punctuation">(</span><span class="token class-name">String</span> uniformName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token function">createUniform</span><span class="token punctuation">(</span>uniformName <span class="token operator">+</span> <span class="token string">&quot;.colour&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">createUniform</span><span class="token punctuation">(</span>uniformName <span class="token operator">+</span> <span class="token string">&quot;.direction&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">createUniform</span><span class="token punctuation">(</span>uniformName <span class="token operator">+</span> <span class="token string">&quot;.intensity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token class-name">String</span> uniformName<span class="token punctuation">,</span> <span class="token class-name">DirectionalLight</span> dirLight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setUniform</span><span class="token punctuation">(</span>uniformName <span class="token operator">+</span> <span class="token string">&quot;.colour&quot;</span><span class="token punctuation">,</span> dirLight<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setUniform</span><span class="token punctuation">(</span>uniformName <span class="token operator">+</span> <span class="token string">&quot;.direction&quot;</span><span class="token punctuation">,</span> dirLight<span class="token punctuation">.</span><span class="token function">getDirection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setUniform</span><span class="token punctuation">(</span>uniformName <span class="token operator">+</span> <span class="token string">&quot;.intensity&quot;</span><span class="token punctuation">,</span> dirLight<span class="token punctuation">.</span><span class="token function">getIntensity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Now we need to use that uniform. We will model how the sun appears to move across the sky by controlling its angle in our <code>DummyGame</code> class.</p> <p><img src="sun_movement.png" alt="Sun Movement"></p> <p>We need to update the light direction so that when the sun is at dawn ($$-90º$$) its direction is $$(-1,0,0)$$ and its $$x$$ component progressively increases from $$-1$$ to $$0$$ and the $$y$$ component increases to $$1$$ as it approaches midday. Then the $$x$$ component increases to $$1$$ and the $$y$$ component decreases to $$0$$ again. This can be done by setting the $$x$$ component to the $$sine$$ of the angle and $$y$$ component to the $$cosine$$ of the angle.</p> <p><img src="sine_cosine.png" alt="Sine and Cosine"></p> <p>We will also modulate light intensity, the intensity will be increasing when it’s getting away from dawn and will decrease as it approaches to dusk. We will simulate the night by setting the intensity to $$0$$. Besides that, we will also modulate the colour so the light gets more red at dawn and at dusk. This will be done in the update method of the <code>DummyGame</code> class.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Update directional light direction, intensity and colour</span>
lightAngle <span class="token operator">+=</span> <span class="token number">1.1f</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>lightAngle <span class="token operator">&gt;</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    directionalLight<span class="token punctuation">.</span><span class="token function">setIntensity</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>lightAngle <span class="token operator">&gt;=</span> <span class="token number">360</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lightAngle <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">90</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>lightAngle <span class="token operator">&lt;=</span> <span class="token operator">-</span><span class="token number">80</span> <span class="token operator">||</span> lightAngle <span class="token operator">&gt;=</span> <span class="token number">80</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">float</span> factor <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>lightAngle<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token operator">/</span> <span class="token number">10.0f</span><span class="token punctuation">;</span>
    directionalLight<span class="token punctuation">.</span><span class="token function">setIntensity</span><span class="token punctuation">(</span>factor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    directionalLight<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>factor<span class="token punctuation">,</span> <span class="token number">0.9f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    directionalLight<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>factor<span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    directionalLight<span class="token punctuation">.</span><span class="token function">setIntensity</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    directionalLight<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    directionalLight<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    directionalLight<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">double</span> angRad <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">toRadians</span><span class="token punctuation">(</span>lightAngle<span class="token punctuation">)</span><span class="token punctuation">;</span>
directionalLight<span class="token punctuation">.</span><span class="token function">getDirection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angRad<span class="token punctuation">)</span><span class="token punctuation">;</span>
directionalLight<span class="token punctuation">.</span><span class="token function">getDirection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angRad<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>Then we need to pass the directional light to our shaders in the render method of the <code>Renderer</code> class.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Get a copy of the directional light object and transform its position to view coordinates</span>
<span class="token class-name">DirectionalLight</span> currDirLight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DirectionalLight</span><span class="token punctuation">(</span>directionalLight<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Vector4f</span> dir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector4f</span><span class="token punctuation">(</span>currDirLight<span class="token punctuation">.</span><span class="token function">getDirection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dir<span class="token punctuation">.</span><span class="token function">mul</span><span class="token punctuation">(</span>viewMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
currDirLight<span class="token punctuation">.</span><span class="token function">setDirection</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Vector3f</span><span class="token punctuation">(</span>dir<span class="token punctuation">.</span>x<span class="token punctuation">,</span> dir<span class="token punctuation">.</span>y<span class="token punctuation">,</span> dir<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
shaderProgram<span class="token punctuation">.</span><span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token string">&quot;directionalLight&quot;</span><span class="token punctuation">,</span> currDirLight<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>As you can see we need to transform the light direction coordinates to view space, but we set the $$w$$ component to $$0$$ since we are not interested in applying translations.</p> <p>Now we are ready to do the real work, which will happen in the fragment shader since the vertex shader does not be modified. We have already stated above that we need to define a new struct, named <code>DirectionalLight</code>, to model a directional light, and we will need a new uniform for that.</p> <div class="language-glsl line-numbers-mode"><pre class="language-glsl"><code><span class="token keyword">uniform</span> DirectionalLight directionalLight<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>We need to refactor our code a little bit. In the previous chapter we had a function called <code>calcPointLight</code> that calculated the diffuse and specular components and also applied the attenuation. As we have explained, directional light also contributes to the diffuse and specular components but is not affected by attenuation, so we will create a new function named <code>calcLightColour</code> that just calculates those components.</p> <div class="language-glsl line-numbers-mode"><pre class="language-glsl"><code><span class="token keyword">vec4</span> <span class="token function">calcLightColour</span><span class="token punctuation">(</span><span class="token keyword">vec3</span> light_colour<span class="token punctuation">,</span> <span class="token keyword">float</span> light_intensity<span class="token punctuation">,</span> <span class="token keyword">vec3</span> position<span class="token punctuation">,</span> <span class="token keyword">vec3</span> to_light_dir<span class="token punctuation">,</span> <span class="token keyword">vec3</span> normal<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">vec4</span> diffuseColour <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">vec4</span> specColour <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Diffuse Light</span>
    <span class="token keyword">float</span> diffuseFactor <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> to_light_dir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    diffuseColour <span class="token operator">=</span> diffuseC <span class="token operator">*</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>light_colour<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> light_intensity <span class="token operator">*</span> diffuseFactor<span class="token punctuation">;</span>

    <span class="token comment">// Specular Light</span>
    <span class="token keyword">vec3</span> camera_direction <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>camera_pos <span class="token operator">-</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">vec3</span> from_light_dir <span class="token operator">=</span> <span class="token operator">-</span>to_light_dir<span class="token punctuation">;</span>
    <span class="token keyword">vec3</span> reflected_light <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token function">reflect</span><span class="token punctuation">(</span>from_light_dir <span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> specularFactor <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span> <span class="token function">dot</span><span class="token punctuation">(</span>camera_direction<span class="token punctuation">,</span> reflected_light<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    specularFactor <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span>specularFactor<span class="token punctuation">,</span> specularPower<span class="token punctuation">)</span><span class="token punctuation">;</span>
    specColour <span class="token operator">=</span> speculrC <span class="token operator">*</span> light_intensity  <span class="token operator">*</span> specularFactor <span class="token operator">*</span> material<span class="token punctuation">.</span>reflectance <span class="token operator">*</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>light_colour<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>diffuseColour <span class="token operator">+</span> specColour<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>Then the method <code>calcPointLight</code> applies the attenuation factor to the light colour calculated in the previous function.</p> <div class="language-glsl line-numbers-mode"><pre class="language-glsl"><code><span class="token keyword">vec4</span> <span class="token function">calcPointLight</span><span class="token punctuation">(</span>PointLight light<span class="token punctuation">,</span> <span class="token keyword">vec3</span> position<span class="token punctuation">,</span> <span class="token keyword">vec3</span> normal<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">vec3</span> light_direction <span class="token operator">=</span> light<span class="token punctuation">.</span>position <span class="token operator">-</span> position<span class="token punctuation">;</span>
    <span class="token keyword">vec3</span> to_light_dir  <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>light_direction<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">vec4</span> light_colour <span class="token operator">=</span> <span class="token function">calcLightColour</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>colour<span class="token punctuation">,</span> light<span class="token punctuation">.</span>intensity<span class="token punctuation">,</span> position<span class="token punctuation">,</span> to_light_dir<span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Apply Attenuation</span>
    <span class="token keyword">float</span> distance <span class="token operator">=</span> <span class="token function">length</span><span class="token punctuation">(</span>light_direction<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> attenuationInv <span class="token operator">=</span> light<span class="token punctuation">.</span>att<span class="token punctuation">.</span>constant <span class="token operator">+</span> light<span class="token punctuation">.</span>att<span class="token punctuation">.</span>linear <span class="token operator">*</span> distance <span class="token operator">+</span>
        light<span class="token punctuation">.</span>att<span class="token punctuation">.</span>exponent <span class="token operator">*</span> distance <span class="token operator">*</span> distance<span class="token punctuation">;</span>
    <span class="token keyword">return</span> light_colour <span class="token operator">/</span> attenuationInv<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>We will create also a new function to calculate the effect of a directional light which just invokes the <code>calcLightColour</code> function with the light direction.</p> <div class="language-glsl line-numbers-mode"><pre class="language-glsl"><code><span class="token keyword">vec4</span> <span class="token function">calcDirectionalLight</span><span class="token punctuation">(</span>DirectionalLight light<span class="token punctuation">,</span> <span class="token keyword">vec3</span> position<span class="token punctuation">,</span> <span class="token keyword">vec3</span> normal<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">calcLightColour</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>colour<span class="token punctuation">,</span> light<span class="token punctuation">.</span>intensity<span class="token punctuation">,</span> position<span class="token punctuation">,</span> <span class="token function">normalize</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>direction<span class="token punctuation">)</span><span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Finally, our main method just aggregates the colour components of the ambient point and directional lights to calculate the fragment colour.</p> <div class="language-glsl line-numbers-mode"><pre class="language-glsl"><code><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">setupColours</span><span class="token punctuation">(</span>material<span class="token punctuation">,</span> outTexCoord<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">vec4</span> diffuseSpecularComp <span class="token operator">=</span> <span class="token function">calcDirectionalLight</span><span class="token punctuation">(</span>directionalLight<span class="token punctuation">,</span> mvVertexPos<span class="token punctuation">,</span> mvVertexNormal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    diffuseSpecularComp <span class="token operator">+=</span> <span class="token function">calcPointLight</span><span class="token punctuation">(</span>pointLight<span class="token punctuation">,</span> mvVertexPos<span class="token punctuation">,</span> mvVertexNormal<span class="token punctuation">)</span><span class="token punctuation">;</span> 

    fragColor <span class="token operator">=</span> ambientC <span class="token operator">*</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>ambientLight<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> diffuseSpecularComp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>And that’s it, we can now simulate the movement of the (artificial) sun across the sky and get something like this (movement is accelerated so it can be viewed without waiting too long).</p> <p><img src="directional_light_result.png" alt="Directional Light results"></p> <h2 id="spot-light"><a href="#spot-light" class="header-anchor">#</a> Spot Light</h2> <p>Now we will implement spot lights which are very similar to point lights but the emitted light is restricted to a 3D cone. It models the light that comes out from focuses or any other light source that does not emit in all directions. A spot light has the same attributes as a point light but adds two new parameters, the cone angle and the cone direction.</p> <p><img src="spot_light.png" alt="Spot Light"></p> <p>Spot light contribution is calculated in the same way as a point light with some exceptions. The points for which the vector that points from the vertex position to the light source is not contained inside the light cone are not affected by the point light.</p> <p><img src="spot_light_ii.png" alt="Spot Light II"></p> <p>How do we calculate if it’s inside the light cone or not? We need to do a dot product again between the vector that points from the light source and the cone direction vector (both of them normalized).</p> <p><img src="spot_light_calc.png" alt="Spot Light calculation"></p> <p>The dot product between $$L$$ and $$C$$ vectors is equal to: $$\vec{L}\cdot\vec{C}=|\vec{L}|\cdot|\vec{C}|\cdot Cos(\alpha)$$. If, in our spot light definition we store the cosine of the cutoff angle, if the dot product is higher than that value we will know that it is inside the light cone (recall the cosine graph, when $$α$$ angle is $$0$$, the cosine will be $$1$$, the smaller the angle the higher the cosine).</p> <p>The second difference is that the points that are far away from the cone vector will receive less light, that is, the attenuation will be higher. There are several ways of calculating this; we will chose a simple approach by multiplying the attenuation by the following factor:</p> <p>$$1 - (1-Cos(\alpha))/(1-Cos(cutOffAngle)$$</p> <p>(In our fragment shaders we won’t have the angle but the cosine of the cutoff angle. You can check that the formula above produces values from 0 to 1, 0 when the angle is equal to the cutoff angle and 1 when the angle is 0).</p> <p>The implementation will be very similar to the rest of lights. We need to create a new class named <code>SpotLight</code>, set up the appropriate uniforms, pass it to the shader and modify the fragment shader to get it. You can check the source code for this chapter.</p> <p>Another important thing when passing the uniforms is that translations should not be applied to the light cone direction since we are only interested in directions. So as in the case of the directional light, when transforming to view space coordinates we must the set $$w$$ component to $$0$$.</p> <p><img src="spot_light_sample.png" alt="Spot Light Sample"></p> <h2 id="multiple-lights"><a href="#multiple-lights" class="header-anchor">#</a> Multiple Lights</h2> <p>So at last we have finally implemented all four types of light, but currently we can only use one instance for each type. This is OK for ambient and directional light but we definitively want to use several point and spot lights. We need to set up our fragment shader to receive a list of lights, so we will use arrays to store that information. Let’s see how this can be done.</p> <p>Before we start, it’s important to note that in GLSL the length of the array must be set at compile time so it must be big enough to accommodate all the objects we need later, at runtime. The first thing that we will do is define some constants to set up the maximum number of point and spot lights that we are going to use.</p> <div class="language-glsl line-numbers-mode"><pre class="language-glsl"><code><span class="token keyword">const</span> <span class="token keyword">int</span> MAX_POINT_LIGHTS <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> MAX_SPOT_LIGHTS <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Then we need to modify the uniforms that previously stored just a single point and spot light to use an array.</p> <div class="language-glsl line-numbers-mode"><pre class="language-glsl"><code><span class="token keyword">uniform</span> PointLight pointLights<span class="token punctuation">[</span>MAX_POINT_LIGHTS<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">uniform</span> SpotLight spotLights<span class="token punctuation">[</span>MAX_SPOT_LIGHTS<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>In the main function we just need to iterate over those arrays to calculate the colour contributions of each instance using the existing functions. We may not pass as many lights as the array length so we need to control it. There are many possible ways to do this: one is to pass a uniform with the actual array length but this may not work with older graphics cards. Instead we will check the light intensity (empty positions in array will have a light intensity equal to 0).</p> <div class="language-glsl line-numbers-mode"><pre class="language-glsl"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>MAX_POINT_LIGHTS<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> pointLights<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>intensity <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        diffuseSpecularComp <span class="token operator">+=</span> <span class="token function">calcPointLight</span><span class="token punctuation">(</span>pointLights<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> mvVertexPos<span class="token punctuation">,</span> mvVertexNormal<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>MAX_SPOT_LIGHTS<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> spotLights<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pl<span class="token punctuation">.</span>intensity <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        diffuseSpecularComp <span class="token operator">+=</span> <span class="token function">calcSpotLight</span><span class="token punctuation">(</span>spotLights<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> mvVertexPos<span class="token punctuation">,</span> mvVertexNormal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Now we need to create those uniforms in the <code>Render</code> class. When we are using arrays we need to create a uniform for each element of the list. So, for instance, for the $$pointLights$$ array we need to create a uniform named <code>pointLights[0]</code>, <code>pointLights[1]</code>, etc. And of course, this translates also to the structure attributes, so we will have <code>pointLights[0].colour</code>, <code>pointLights[1], colour</code>, etc. The methods to create those uniforms are as follows.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createPointLightListUniform</span><span class="token punctuation">(</span><span class="token class-name">String</span> uniformName<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">createPointLightUniform</span><span class="token punctuation">(</span>uniformName <span class="token operator">+</span> <span class="token string">&quot;[&quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createSpotLightListUniform</span><span class="token punctuation">(</span><span class="token class-name">String</span> uniformName<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">createSpotLightUniform</span><span class="token punctuation">(</span>uniformName <span class="token operator">+</span> <span class="token string">&quot;[&quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>We also need methods to set up the values of those uniforms.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token class-name">String</span> uniformName<span class="token punctuation">,</span> <span class="token class-name">PointLight</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pointLights<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> numLights <span class="token operator">=</span> pointLights <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> pointLights<span class="token punctuation">.</span>length <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numLights<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setUniform</span><span class="token punctuation">(</span>uniformName<span class="token punctuation">,</span> pointLights<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token class-name">String</span> uniformName<span class="token punctuation">,</span> <span class="token class-name">PointLight</span> pointLight<span class="token punctuation">,</span> <span class="token keyword">int</span> pos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setUniform</span><span class="token punctuation">(</span>uniformName <span class="token operator">+</span> <span class="token string">&quot;[&quot;</span> <span class="token operator">+</span> pos <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">,</span> pointLight<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token class-name">String</span> uniformName<span class="token punctuation">,</span> <span class="token class-name">SpotLight</span><span class="token punctuation">[</span><span class="token punctuation">]</span> spotLights<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> numLights <span class="token operator">=</span> spotLights <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> spotLights<span class="token punctuation">.</span>length <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numLights<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setUniform</span><span class="token punctuation">(</span>uniformName<span class="token punctuation">,</span> spotLights<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token class-name">String</span> uniformName<span class="token punctuation">,</span> <span class="token class-name">SpotLight</span> spotLight<span class="token punctuation">,</span> <span class="token keyword">int</span> pos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setUniform</span><span class="token punctuation">(</span>uniformName <span class="token operator">+</span> <span class="token string">&quot;[&quot;</span> <span class="token operator">+</span> pos <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">,</span> spotLight<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>Finally we just need to update the <code>Render</code> class to receive a list of point and spot lights, and modify accordingly the <code>DummyGame</code> class to create those list to see something like this.</p> <p><img src="multiple_lights.png" alt="Multiple Lights"></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/CraftStarStudio/wjglbook-bookcontents-zh_CN/edit/master/chapter11/chapter11.md" target="_blank" rel="noopener noreferrer">帮助我们完善这个页面</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最后更新 :</span> <span class="time">6/27/2021, 1:14:09 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/3d-game-development-with-lwjgl/chapter10/chapter10.html" class="prev">
        Let there be light
      </a></span> <span class="next"><a href="/3d-game-development-with-lwjgl/chapter12/chapter12.html">
        Game HUD
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/3d-game-development-with-lwjgl/assets/js/app.519c1cc5.js" defer></script><script src="/3d-game-development-with-lwjgl/assets/js/2.e7870360.js" defer></script><script src="/3d-game-development-with-lwjgl/assets/js/20.9046ed34.js" defer></script>
  </body>
</html>
